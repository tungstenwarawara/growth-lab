# Claude Code 公式ベストプラクティス要約

**出典**: https://code.claude.com/docs/ja/
**最終更新**: 2026-02-08

---

## 1. コンテキスト管理（最重要）

Claude のパフォーマンスはコンテキストがいっぱいになると低下する。
コンテキストウィンドウは管理すべき最も重要なリソース。

### CLAUDE.md のルール

- **500行以下を維持する**（超えたら skill に移動）
- 毎セッション自動読み込みされるため、広く適用されるものだけ書く
- 「これを削除すると Claude が間違いを犯すか？」で取捨選択
- コードから推測できることは書かない
- 定期的に棚卸しする

**書くべき内容**:
- Claude が推測できない Bash コマンド
- デフォルトと異なるコードスタイルルール
- テスト指示
- リポジトリのエチケット（ブランチ命名、PR 規約）
- プロジェクト固有のアーキテクチャ決定
- 一般的な落とし穴

**書かないべき内容**:
- コードを読めばわかること
- 標準言語規約
- 詳細な API ドキュメント（リンクで）
- 頻繁に変わる情報
- ファイルごとのコードベース説明
- 自明なプラクティス

### コンテキストクリア

- タスク切り替え時に `/clear` を実行
- 同じ問題で2回以上修正が失敗したら `/clear` して新しいプロンプトで再開
- コンパクション時に保持したい情報は CLAUDE.md に明示

---

## 2. 拡張機能の使い分け

| 機能 | 読み込み | コスト | 使う場面 |
|------|---------|--------|---------|
| **CLAUDE.md** | 全セッション | 毎リクエスト | 「常にXを実行する」ルール |
| **Skills** | オンデマンド | 低い（説明のみ） | 再利用可能なワークフロー、リファレンス |
| **Subagents** | スポーン時 | メインから分離 | コンテキスト分離、並列タスク |
| **MCP** | セッション開始 | 毎リクエスト | 外部サービス連携 |
| **Hooks** | トリガー時 | ゼロ | 決定論的な自動化 |
| **Agent Teams** | 独立セッション | 高い（個別インスタンス） | 複雑な協調作業 |

### 判断フロー

```
常に必要？ → CLAUDE.md
時々必要なリファレンス？ → Skill
ワークフローをトリガー？ → Skill（/name で呼出）
外部サービスに接続？ → MCP
例外なく毎回実行？ → Hook
コンテキスト分離が必要？ → Subagent
複数セッションで協調？ → Agent Team
```

---

## 3. Skills の設計原則

### リファレンス Skill
- API スタイルガイド、コーディング規約など
- Claude が自動的に読み込むか、`/name` で呼出

### アクション Skill
- デプロイ、レビュー、Issue修正などのワークフロー
- `disable-model-invocation: true` で手動トリガーのみに

### Skill のコンテキストコスト制御
- デフォルト: 説明のみがセッション開始時に読み込まれる
- `disable-model-invocation: true`: 呼び出すまでコストゼロ
- Subagent に skill を渡すと起動時に完全プリロード

---

## 4. 効果的なワークフロー

### 基本サイクル: 探索 → 計画 → 実装 → コミット

1. **Plan Mode**（Shift+Tab）で読み取り専用分析
2. 計画をレビュー（Ctrl+G でエディタで編集可能）
3. Normal Mode に戻って実装
4. コミット・PR作成

### 検証を必ず含める
- テスト、スクリーンショット、期待される出力を提供
- 検証なしのコードは出荷しない

### プロンプトの書き方
- 具体的なファイルを指摘する（`@file` 参照）
- 制約を述べる
- 既存パターンを参照させる
- 症状と可能性のある場所を説明する

---

## 5. セッション管理

- `/clear`: コンテキストリセット
- `/rewind` or `Esc+Esc`: チェックポイントに戻る
- `claude --continue`: 最新セッションを再開
- `claude --resume`: セッション選択
- `/rename`: セッションに名前を付ける

---

## 6. スケーリング

### Subagents（コンテキスト分離の最強ツール）
- 別コンテキストで探索→要約のみ返す
- 「use subagents to investigate X」で委譲

### 並列セッション
- Git Worktrees で完全分離
- Writer/Reviewer パターン

### ヘッドレスモード
- `claude -p "prompt"`: CI/CD統合
- `--output-format json|stream-json`: 構造化出力
- `--allowedTools` でツール制限

---

## 7. アンチパターン

| パターン | 問題 | 対策 |
|---------|------|------|
| キッチンシンク | 無関係なタスクの混在 | `/clear` で分離 |
| 何度も修正 | 失敗コンテキストの蓄積 | 2回失敗で `/clear` + 新プロンプト |
| 過度なCLAUDE.md | ルールがノイズに埋没 | 削除して500行以下 |
| 検証なし | もっともらしいが動かないコード | 必ずテスト/スクリーンショット |
| 無限探索 | コンテキスト枯渇 | Subagent で分離 |

---

## 8. 大賢者への適用指針

### CLAUDE.md を肥大化させない
- 現在43行 → 良い状態。50行以下を維持
- 大賢者の詳細仕様は Skill に移動済み（正しい判断）

### Skill 設計の最適化
- 大賢者 SKILL.md: description を明確に（自動読み込み判断に使われる）
- オーケストレーター: `disable-model-invocation: true` を検討
  - 自動で動くべきか、`/great-sage` で呼ぶべきか判断
- コンテンツマネージャー: 354行は大きすぎる → 分割を検討

### 機能拡張時のチェックリスト
1. [ ] その機能は CLAUDE.md に書くべきか、Skill にすべきか
2. [ ] Skill の行数は適切か（200行以下が目安）
3. [ ] `disable-model-invocation` が必要か
4. [ ] 既存の公式機能で代替できないか
5. [ ] コンテキストコストは許容範囲か
6. [ ] Subagent で分離すべき処理ではないか

### 精度を落とさない拡張の原則
```
機能を追加する = コンテキストコストが増える
コンテキストコストが増える = 既存機能の精度が落ちる

→ 追加するなら、同時に何かを削るか分離する
→ 「足し算」ではなく「入れ替え」の思考で
```

---

*このファイルは公式ドキュメントの要点を圧縮したもの。原文が更新されたら見直す。*
